{"ast":null,"code":"var _jsxFileName = \"/home/imane/Documents/M1/S2/Projet annuel/frontend/src/pages/ChallengePage.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport Editor from '@monaco-editor/react';\nimport Axios from '../axios-config';\nimport { useAuthHeader, useAuthUser } from 'react-auth-kit';\nimport { Carousel } from '../components/challenges/Carousel';\nimport toast from 'react-hot-toast';\nimport { AttemptsCarousel } from '../components/challenges/AttemptsCarousel';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport const ChallengePage = props => {\n  _s();\n\n  const [challenge, setChallenge] = useState({});\n  const [code, setCode] = useState('');\n  const [bootstrap, setBootstrap] = useState({});\n  const [attempts, setAttempts] = useState([]);\n  const [stdout, setStdout] = useState('STDOUT');\n  const [stderr, setStderr] = useState('STDERR');\n  const [startLine, setStartLine] = useState(0);\n  const authHeader = useAuthHeader();\n  const currentUser = useAuthUser();\n  useEffect(() => {\n    const fetchAttempts = async () => {\n      var _currentUser;\n\n      const {\n        data: {\n          content\n        }\n      } = await Axios.get(`attempts/find-by-user-and-bootstrap/${(_currentUser = currentUser()) === null || _currentUser === void 0 ? void 0 : _currentUser.sub}/${bootstrap._id}`);\n      setAttempts(content);\n    };\n\n    if (bootstrap._id) {\n      fetchAttempts();\n    }\n  }, [bootstrap._id, stdout]);\n  useEffect(() => {\n    const fetchChallenge = async id => {\n      var _bootstrap$tests, _bootstrap$tests$spli;\n\n      const {\n        data: {\n          content\n        }\n      } = await Axios.get(`/challenges/${id}`, {\n        headers: {\n          Authorization: authHeader()\n        }\n      });\n      setChallenge(content);\n      const bootstrap = content.execBootstraps.find(eb => eb.language === props.match.params.language);\n      setStartLine((bootstrap === null || bootstrap === void 0 ? void 0 : (_bootstrap$tests = bootstrap.tests) === null || _bootstrap$tests === void 0 ? void 0 : (_bootstrap$tests$spli = _bootstrap$tests.split('\\n')) === null || _bootstrap$tests$spli === void 0 ? void 0 : _bootstrap$tests$spli.length) || 0);\n      setBootstrap(bootstrap || {});\n    };\n\n    fetchChallenge(props.match.params.id);\n  }, [props.match.params.id]);\n  useEffect(() => {\n    const fetchChallenge = async id => {\n      var _bootstrap$tests2, _bootstrap$tests2$spl;\n\n      const {\n        data: {\n          content\n        }\n      } = await Axios.get(`/challenges/${id}`, {\n        headers: {\n          Authorization: authHeader()\n        }\n      });\n      setChallenge(content);\n      const bootstrap = content.execBootstraps.find(eb => eb.language === props.match.params.language);\n      setStartLine((bootstrap === null || bootstrap === void 0 ? void 0 : (_bootstrap$tests2 = bootstrap.tests) === null || _bootstrap$tests2 === void 0 ? void 0 : (_bootstrap$tests2$spl = _bootstrap$tests2.split('\\n')) === null || _bootstrap$tests2$spl === void 0 ? void 0 : _bootstrap$tests2$spl.length) || 0);\n      setBootstrap(bootstrap || {});\n    };\n\n    fetchChallenge(props.match.params.id);\n  }, [props.match.params.id]);\n  useEffect(() => {\n    var _challenge$execBootst, _challenge$execBootst2;\n\n    const placeholder = challenge === null || challenge === void 0 ? void 0 : (_challenge$execBootst = challenge.execBootstraps) === null || _challenge$execBootst === void 0 ? void 0 : (_challenge$execBootst2 = _challenge$execBootst.find(eb => eb.language === props.match.params.language)) === null || _challenge$execBootst2 === void 0 ? void 0 : _challenge$execBootst2.functionTemplate;\n\n    if (placeholder) {\n      // setCodePlaceholder(placeholder);\n      setCode(placeholder);\n    }\n  }, [challenge]);\n\n  const runOnClick = () => {\n    const toastId = toast.loading('Running code...');\n    Axios.post(`/attempts`, {\n      execBootstrap: bootstrap === null || bootstrap === void 0 ? void 0 : bootstrap._id,\n      code\n    }, {\n      headers: {\n        Authorization: authHeader()\n      }\n    }).then(({\n      data\n    }) => {\n      toast.success(`Successfully ran the code.`, {\n        id: toastId\n      });\n      setStderr(data.content.stderr);\n      setStdout(data.content.stdout);\n    }).catch(err => {\n      if (err.isAxiosError) {\n        var _err$response;\n\n        toast.error(`An error occured: ${(_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data.message}`, {\n          id: toastId\n        });\n      } else {\n        toast.error(`An unknown error occured: ${err}`, {\n          id: toastId\n        });\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"py-6 flex flex-col justify-center\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid grid-cols-12 gap-2 rounded px-5 h-screen\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-pink-900 rounded m-15 p-4 col-span-9\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-bold text-xl mb-2 flex flex-row\",\n            children: [challenge.name, /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"bg-black py-1 px-2 rounded-full text-sm w-min ml-2\",\n              children: props.match.params.language\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: challenge.instructions\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Carousel, {\n          className: \"h-64 max-h-64 flex flex-col items-center bg-pink-900 rounded p-5 col-span-3\",\n          picturesUrls: challenge.pictures\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"rounded-lg h-full overflow-hidden flex flex-col justify-center items-center col-span-6\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative max-h-full w-full\",\n            children: [/*#__PURE__*/_jsxDEV(Editor, {\n              options: {\n                lineNumbers: lineNumber => {\n                  return (lineNumber + startLine).toString();\n                }\n              },\n              language: props.match.params.language,\n              defaultLanguage: props.match.params.language,\n              height: \"80vh\",\n              onChange: value => {\n                setCode(value);\n              },\n              value: code,\n              theme: \"vs-dark\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"absolute bottom-0 right-0 bg-blue-500 px-2 rounded-tl-lg h-10 w-20 \",\n              onClick: runOnClick,\n              children: \"Run\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"h-auto w-full overflow-hidden rounded-lg col-span-6 divide-y-4 divide-gray-800 divide-dotted\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-black max-h-1/2 h-1/2 p-2 w-full text-left font-light overflow-y-scroll\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"whitespace-pre-line\",\n              children: stderr || \"Aucune erreur durant l'execution de ce code.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-black max-h-1/2 h-1/2 p-2 w-full text-left font-light overflow-y-scroll\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"whitespace-pre-line\",\n              children: stdout || \"Aucune sortie après l'execution de ce code.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(AttemptsCarousel, {\n          onLoadCode: code => {\n            setCode(code);\n          },\n          className: \"col-span-12\",\n          attempts: attempts\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n\n_s(ChallengePage, \"w/tpnKG/PfKCPY2bmhL5XaOvJIU=\", false, function () {\n  return [useAuthHeader, useAuthUser];\n});\n\n_c = ChallengePage;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChallengePage\");","map":{"version":3,"sources":["/home/imane/Documents/M1/S2/Projet annuel/frontend/src/pages/ChallengePage.tsx"],"names":["React","useEffect","useState","Editor","Axios","useAuthHeader","useAuthUser","Carousel","toast","AttemptsCarousel","ChallengePage","props","challenge","setChallenge","code","setCode","bootstrap","setBootstrap","attempts","setAttempts","stdout","setStdout","stderr","setStderr","startLine","setStartLine","authHeader","currentUser","fetchAttempts","data","content","get","sub","_id","fetchChallenge","id","headers","Authorization","execBootstraps","find","eb","language","match","params","tests","split","length","placeholder","functionTemplate","runOnClick","toastId","loading","post","execBootstrap","then","success","catch","err","isAxiosError","error","response","message","name","instructions","pictures","lineNumbers","lineNumber","toString","value"],"mappings":"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","sourcesContent":["/* eslint-disable react-hooks/exhaustive-deps */\nimport React, { useEffect, useState } from 'react';\nimport Editor from '@monaco-editor/react';\nimport Axios from '../axios-config';\nimport { useAuthHeader, useAuthUser } from 'react-auth-kit';\nimport { Carousel } from '../components/challenges/Carousel';\nimport toast from 'react-hot-toast';\nimport {\n  AttemptProps,\n  AttemptsCarousel,\n} from '../components/challenges/AttemptsCarousel';\n\ntype Challenge = {\n  _id: string;\n  name: string;\n  instructions: string;\n  pictures: { file: string }[];\n  execBootstraps: {\n    _id: string;\n    tests: string;\n    functionTemplate: string;\n    language: string;\n  }[];\n};\n\nexport const ChallengePage = (props: {\n  match: { params: { id: string; language: string } };\n}) => {\n  const [challenge, setChallenge] = useState({} as Challenge);\n  const [code, setCode] = useState('');\n  const [bootstrap, setBootstrap] = useState({} as { _id: string });\n\n  const [attempts, setAttempts] = useState([] as AttemptProps[]);\n\n  const [stdout, setStdout] = useState('STDOUT');\n  const [stderr, setStderr] = useState('STDERR');\n\n  const [startLine, setStartLine] = useState(0);\n\n  const authHeader = useAuthHeader();\n  const currentUser = useAuthUser();\n\n  useEffect(() => {\n    const fetchAttempts = async () => {\n      const {\n        data: { content },\n      } = await Axios.get(\n        `attempts/find-by-user-and-bootstrap/${currentUser() ?.sub}/${\n        bootstrap._id\n        }`,\n      );\n      setAttempts(content);\n    };\n\n    if (bootstrap._id) {\n      fetchAttempts();\n    }\n  }, [bootstrap._id, stdout]);\n\n  useEffect(() => {\n    const fetchChallenge = async (id: string) => {\n      const {\n        data: { content },\n      } = await Axios.get(`/challenges/${id}`, {\n        headers: { Authorization: authHeader() },\n      });\n      setChallenge(content);\n      const bootstrap = (content as Challenge).execBootstraps.find(\n        (eb) => eb.language === props.match.params.language,\n      );\n      setStartLine(bootstrap ?.tests ?.split('\\n') ?.length || 0);\n      setBootstrap(bootstrap || ({} as { _id: string }));\n    };\n\n    fetchChallenge(props.match.params.id);\n  }, [props.match.params.id]);\n\n  useEffect(() => {\n    const fetchChallenge = async (id: string) => {\n      const {\n        data: { content },\n      } = await Axios.get(`/challenges/${id}`, {\n        headers: { Authorization: authHeader() },\n      });\n      setChallenge(content);\n      const bootstrap = (content as Challenge).execBootstraps.find(\n        (eb) => eb.language === props.match.params.language,\n      );\n      setStartLine(bootstrap ?.tests ?.split('\\n') ?.length || 0);\n      setBootstrap(bootstrap || ({} as { _id: string }));\n    };\n\n    fetchChallenge(props.match.params.id);\n  }, [props.match.params.id]);\n\n  useEffect(() => {\n    const placeholder = challenge ?.execBootstraps ?.find(\n      (eb) => eb.language === props.match.params.language,\n    ) ?.functionTemplate;\n\n    if (placeholder) {\n      // setCodePlaceholder(placeholder);\n      setCode(placeholder);\n    }\n  }, [challenge]);\n\n  const runOnClick = () => {\n    const toastId = toast.loading('Running code...');\n\n    Axios.post(\n      `/attempts`,\n      {\n        execBootstrap: bootstrap ?._id,\n        code,\n      },\n      {\n        headers: {\n          Authorization: authHeader(),\n        },\n      },\n    )\n      .then(({ data }) => {\n        toast.success(`Successfully ran the code.`, {\n          id: toastId,\n        });\n\n        setStderr(data.content.stderr);\n        setStdout(data.content.stdout);\n      })\n      .catch((err) => {\n        if (err.isAxiosError) {\n          toast.error(`An error occured: ${err.response ?.data.message}`, {\n            id: toastId,\n          });\n        } else {\n          toast.error(`An unknown error occured: ${err}`, { id: toastId });\n        }\n      });\n  };\n\n  return (\n    <>\n      <div className=\"py-6 flex flex-col justify-center\">\n        <div className=\"grid grid-cols-12 gap-2 rounded px-5 h-screen\">\n          <div className=\"bg-pink-900 rounded m-15 p-4 col-span-9\">\n            <div className=\"font-bold text-xl mb-2 flex flex-row\">\n              {challenge.name}\n              <div className=\"bg-black py-1 px-2 rounded-full text-sm w-min ml-2\">\n                {props.match.params.language}\n              </div>\n            </div>\n            <p>{challenge.instructions}</p>\n          </div>\n          <Carousel\n            className=\"h-64 max-h-64 flex flex-col items-center bg-pink-900 rounded p-5 col-span-3\"\n            picturesUrls={challenge.pictures}\n          />\n          <div className=\"rounded-lg h-full overflow-hidden flex flex-col justify-center items-center col-span-6\">\n            <div className=\"relative max-h-full w-full\">\n              <Editor\n                options={{\n                  lineNumbers: (lineNumber: number) => {\n                    return (lineNumber + startLine).toString();\n                  },\n                }}\n                language={props.match.params.language}\n                defaultLanguage={props.match.params.language}\n                height=\"80vh\"\n                onChange={(value) => {\n                  setCode(value as string);\n                }}\n                value={code}\n                theme=\"vs-dark\"\n              />\n\n              <button\n                className=\"absolute bottom-0 right-0 bg-blue-500 px-2 rounded-tl-lg h-10 w-20 \"\n                onClick={runOnClick}\n              >\n                Run\n              </button>\n            </div>\n          </div>\n          <div className=\"h-auto w-full overflow-hidden rounded-lg col-span-6 divide-y-4 divide-gray-800 divide-dotted\">\n            <div className=\"bg-black max-h-1/2 h-1/2 p-2 w-full text-left font-light overflow-y-scroll\">\n              <span className=\"whitespace-pre-line\">\n                {stderr || \"Aucune erreur durant l'execution de ce code.\"}\n              </span>\n            </div>\n            <div className=\"bg-black max-h-1/2 h-1/2 p-2 w-full text-left font-light overflow-y-scroll\">\n              <span className=\"whitespace-pre-line\">\n                {stdout || \"Aucune sortie après l'execution de ce code.\"}\n              </span>\n            </div>\n          </div>\n          <AttemptsCarousel\n            onLoadCode={(code) => {\n              setCode(code);\n            }}\n            className=\"col-span-12\"\n            attempts={attempts}\n          />\n        </div>\n      </div>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}